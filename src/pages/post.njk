---
pagination:
  data: collections.post
  size: 1
  alias: post
permalink: /{{ post.data.slug }}/
---

{% extends 'base.njk' %}

{% block title %}
	{{ post.data.title }} | Population Interventions Unit
{% endblock %}

{% block head %}

	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
	<script defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.js" integrity="sha384-g7c+Jr9ZivxKLnZTDUhnkOnsh30B4H0rpLUpJ4jAIKs4fnJI+sEnkvrMWph2EDg4" crossorigin="anonymous"></script>
	<script defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/contrib/auto-render.min.js" integrity="sha384-mll67QQFJfxn0IYznZYonOWZ644AWYC+Pt2cHqMaRhXVrursRwvLnLaebdGIlYNa" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script>

	<meta charset="utf-8">
	<script src="https://cdn.jsdelivr.net/npm/vega@5"></script>

	{% if post.data.d3 %}
		<script src="https://d3js.org/d3.v4.min.js"></script>
	{% endif %}

	{# <script src="https://cdn.jsdelivr.net/npm/choices.js@9.0.1/public/assets/scripts/choices.min.js"></script> #}

	<script type="text/javascript">
		function loadCSS(path) { 
			let file = document.createElement("link");
			file.setAttribute("rel", "stylesheet");
			file.setAttribute("type", "text/css");
			file.setAttribute("href", path);
			document.head.appendChild(file);
		}

		var graphs = [];
	</script>					
	
	{# {% if post.data.hidden %} #}
		<meta name="robots" content="noindex">
		<meta name="googlebot" content="noindex">
	{# {% endif %}     #}

{% endblock %}

{% block breadcrumb %}
	<li class="root" itemprop="itemListElement" itemscope="" itemtype="http://schema.org/ListItem">
		<a href="/{{ post.data.slug }}" title="{{ post.data.title }}" itemprop="item">
			<span itemprop="name">{{ post.data.title }}</span>
		</a>
		<meta content="2" itemprop="position" />
	</li>
{% endblock %}

{% block content %}

	{% if post.data.hidden %}
		<div class="flash flash--warning flash--center">
			<p>
				<strong>This page is a draft.</strong> All content is provisional.
			</p>
		</div>
	{% endif %}

	<h1 class="aligned-title">{{ post.data.title }}</h1>

	<section class="lead left">
		<p>{{ post.data.description}}</p>
	</section>

	{{ post.templateContent | markdown | safe }}


	<script type="text/javascript">

		var views = {},
			choices = {};

		function slugify(text) {
			return text.toString().toLowerCase()
				.replace(/\s+/g, '-')           // Replace spaces with -
				.replace(/[^\w\-]+/g, '')       // Remove all non-word chars
				.replace(/\-\-+/g, '-')         // Replace multiple - with single -
				.replace(/^-+/, '')             // Trim - from start of text
				.replace(/-+$/, '');            // Trim - from end of text
		}

		function render(key, spec) {
			
			views[key] = new vega.View(vega.parse(spec), {
				renderer: 'svg',  			// renderer (canvas or svg)
				container: `#graph-container-${key}`,  // parent DOM container
				hover: true       				// enable hover processing
			});
			
			// Initialise Choices.js on toggles.
			// if (spec.hasOwnProperty('uom-toggles')) {
			// 	for (let toggleGroup of spec['uom-toggles']['toggle-groups']) {
			// 		for (let toggle of toggleGroup.toggles) {
			// 			if (toggle.type == 'select') {

			// 				let select = document.querySelector(`#select-${key}-${slugify(toggle.name)}`);
			// 				select.parentNode.classList.remove('styled-select');
			// 				select.removeAttribute('data-bound-fancyselect');
			// 				// console.log();
			// 				choices[`${key}-${slugify(toggle.name)}`] = new Choices(select, {
			// 					searchEnabled: false
			// 				});

			// 			}
			// 		}
			// 	}
			// }

			return views[key].runAsync();

		}

		for (let key of graphs) {
		
			fetch('/posts/{{ post.data.slug }}/graph-' + key + '.json')
				.then(res => res.json())
				.then(spec => render(key, spec))
				.catch(err => console.error(err));

		}
	
	</script>

	{# TODO - make more responsive: https://bl.ocks.org/donghaoren/023b2246569e8f0615017507b473e55e #}

{% endblock %}